syntax = "proto3";

package test.api.v1;

import "buf/validate/validate.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/cjermain/protoc-gen-pydantic/test/api";

// ValidatedScalars exercises numeric bound constraints.
message ValidatedScalars {
  // Age must be between 0 and 150 exclusive of 0.
  int32 age = 1 [(buf.validate.field).int32.gt = 0, (buf.validate.field).int32.lte = 150];
  // Score must be in [0.0, 100.0].
  double score = 2 [(buf.validate.field).double.gte = 0.0, (buf.validate.field).double.lte = 100.0];
  // Priority must be positive.
  int64 priority = 3 [(buf.validate.field).int64.gt = 0];
  // Ratio must be non-negative and less than 1.
  float ratio = 4 [(buf.validate.field).float.gte = 0.0, (buf.validate.field).float.lt = 1.0];
  // Rank must be in [1, 10].
  uint32 rank = 5 [(buf.validate.field).uint32.gte = 1, (buf.validate.field).uint32.lte = 10];
  // Count must be non-zero (covers uint64 / fixed64 literal formatting).
  optional uint64 count = 6 [(buf.validate.field).uint64.gt = 0];
  // Offset must be non-negative (covers sint32 / sfixed32 literal formatting).
  optional sint32 offset = 7 [(buf.validate.field).sint32.gte = 0];
}

// ValidatedStrings exercises string length and pattern constraints.
message ValidatedStrings {
  // Name must be between 1 and 100 characters.
  string name = 1 [(buf.validate.field).string.min_len = 1, (buf.validate.field).string.max_len = 100];
  // Code must match uppercase letters only.
  string code = 2 [(buf.validate.field).string.pattern = "^[A-Z]+$"];
  // Bio has only a max length.
  string bio = 3 [(buf.validate.field).string.max_len = 500];
  // Tag has only a min length.
  string tag = 4 [(buf.validate.field).string.min_len = 2];
}

// ValidatedRepeated exercises repeated field length constraints.
message ValidatedRepeated {
  // Items must have between 1 and 10 elements.
  repeated string items = 1 [(buf.validate.field).repeated.min_items = 1, (buf.validate.field).repeated.max_items = 10];
  // Tags must have at least 1 element.
  repeated string tags = 2 [(buf.validate.field).repeated.min_items = 1];
}

// ValidatedMap exercises map field length constraints.
message ValidatedMap {
  // Labels must have between 1 and 10 entries.
  map<string, string> labels = 1 [
    (buf.validate.field).map.min_pairs = 1,
    (buf.validate.field).map.max_pairs = 10
  ];
}

// ValidatedReserved exercises a field whose name is a Python reserved word and
// also carries a buf.validate constraint. The generated field must emit both
// alias= and the constraint kwargs in a single _Field() call.
message ValidatedReserved {
  // Score must be positive.
  float float = 1 [(buf.validate.field).float.gt = 0.0];
}

// ValidatedOneof exercises a oneof field that also carries a constraint.
message ValidatedOneof {
  oneof value {
    // Must be positive when set.
    int32 small = 1 [(buf.validate.field).int32.gt = 0];
    // Must be positive when set.
    int64 large = 2 [(buf.validate.field).int64.gt = 0];
  }
}

// ValidatedDuration exercises Duration bound constraints, which use
// message-typed rule fields and cannot be translated to Pydantic Field() args.
// The generator must not panic; instead it emits dropped-constraint comments.
message ValidatedDuration {
  // Timeout must be positive and at most one hour.
  google.protobuf.Duration timeout = 1 [
    (buf.validate.field).duration.gt = {seconds: 0},
    (buf.validate.field).duration.lte = {seconds: 3600}
  ];
}

// ValidatedTimestamp exercises Timestamp bound constraints, which also use
// message-typed rule fields and must not panic.
message ValidatedTimestamp {
  // CreatedAt must be after the Unix epoch.
  google.protobuf.Timestamp created_at = 1 [
    (buf.validate.field).timestamp.gt = {seconds: 0}
  ];
}

// ValidatedStringLen exercises the string.len exact-length constraint.
message ValidatedStringLen {
  // Code must be exactly 5 characters.
  string code = 1 [(buf.validate.field).string.len = 5];
}

// ValidatedStringAffix exercises string.prefix and string.suffix constraints.
message ValidatedStringAffix {
  // Url must start with "https://".
  string url = 1 [(buf.validate.field).string.prefix = "https://"];
  // Filename must end with ".go".
  string filename = 2 [(buf.validate.field).string.suffix = ".go"];
  // Path must start with "/home/" and end with ".txt".
  string path = 3 [
    (buf.validate.field).string.prefix = "/home/",
    (buf.validate.field).string.suffix = ".txt"
  ];
  // Content must match a pattern; prefix is also set (conflict â†’ prefix dropped).
  string content = 4 [
    (buf.validate.field).string.pattern = "^[a-z]+$",
    (buf.validate.field).string.prefix = "abc"
  ];
}

// ValidatedExamples exercises the field examples annotation.
message ValidatedExamples {
  // Count with integer examples.
  int32 count = 1 [
    (buf.validate.field).int32.gt = 0,
    (buf.validate.field).int32.example = 1,
    (buf.validate.field).int32.example = 42
  ];
  // Name with string examples.
  string name = 2 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).string.example = "alice",
    (buf.validate.field).string.example = "bob"
  ];
}

// ValidatedSilentDrop exercises constraints that were previously silently
// ignored but now emit dropped-constraint comments via the default case in
// extractRuleField.
message ValidatedSilentDrop {
  // Email must be a valid email address.
  string email = 1 [(buf.validate.field).string.email = true];
  // Website must be a valid URI.
  string website = 2 [(buf.validate.field).string.uri = true];
  // Address must be a valid IP address.
  string address = 3 [(buf.validate.field).string.ip = true];
  // Tags must contain unique elements.
  repeated string tags = 4 [(buf.validate.field).repeated.unique = true];
  // Ratio must be finite (not inf or NaN).
  float ratio = 5 [(buf.validate.field).float.finite = true];
  // Token must be a valid UUID.
  string token = 6 [(buf.validate.field).string.uuid = true];
  // Host must be a valid IPv4 address.
  string host_v4 = 7 [(buf.validate.field).string.ipv4 = true];
  // Host must be a valid IPv6 address.
  string host_v6 = 8 [(buf.validate.field).string.ipv6 = true];
}

// ValidatedDropped exercises constraints that are recognised but not translated.
message ValidatedDropped {
  // Name is required; the required constraint is not translated.
  string name = 1 [(buf.validate.field).required = true];
  // Tag must equal "fixed"; the const constraint is not translated.
  string tag = 2 [(buf.validate.field).string.const = "fixed"];
  // Score must be positive; required is also set but not translated.
  int32 score = 3 [(buf.validate.field).required = true, (buf.validate.field).int32.gt = 0];
}
